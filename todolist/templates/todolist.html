{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block meta %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>wishlist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/todolist.css' %}">
    {% endblock meta %}
</head>

<body>
    {% block content %}
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #446DCA;">
        <a class="navbar-brand" href="#">Welcome back, </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-item nav-link active" href="#">{{username}}</a>
            <a class="nav-item nav-link" href="{% url 'todolist:add_task' %} ">Add task</a>
            <a class="nav-item nav-link" href="{% url 'todolist:logout' %}">Log out</a>
            <!-- Button for Triggering Modal -->
            <a class="nav-item nav-link" data-bs-target="#exampleModal" data-bs-toggle="modal" href="#exampleModal">Add task with modal</a>
          </div>
        </div>

        <a class="nav-item nav-link active text-white" href="#">Sesi terakhir: {{ last_login }}</a>

      </nav>



    <!-- Task Card -->
    <div class="row">
    {% for task in list_task %}
        <div class="col-sm-4">
            <div class="card">
                <div class="card-header">
                    {% if task.is_finished %}
                        <h5>Done</h5>
                    {% else %}
                        <h5>In Progress</h5>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{task.title}}</h5>
                    <p class="card-text">{{task.description}}</p>
                </div>
                    
                <div class="card-footer">
                    <p class="card-text"><small class="text-muted">Task created {{task.date}}</small></p>
                    <div class = "btn-toolbar pull-right">
    
                        <form method="post" action="{% url 'todolist:delete-task' task.id %}" >
                            {% csrf_token %}
                            <button class="btn text-white me-1 btn-danger" type="submit" name="toggle_done">
                                Delete
                            </button>
                        </form>

                        <form method="post" action="{% url 'todolist:toggle-task' task.id %}" >
                            {% csrf_token %}
                            <button class="btn text-white me-1" style="background-color: #446DCA;" type="submit" name="toggle_done">
                                {% if task.is_finished %} Mark Not Done {% else %} Mark Done {% endif %}
                            </button>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>

    
    <!-- Modal -->
    <!-- Vertically centered scrollable modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">New task</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" >  
                {% csrf_token %} 
                <div class="mb-3">
                    <label for="for-task-title" class="col-form-label">Title:</label>
                    <input type="text" class="form-control" id="title">
                </div>
                <div class="mb-3">
                    <label for="for-task-desc" class="col-form-label">Description:</label>
                    <input class="form-control" id="desc">
                </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
                    <button type="button" style="background-color: #446DCA;" class="btn btn-primary">Add task</button>
                </div>
                </form>
            </div>
        </div>
        </div>
    {% endblock content %}

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous">
        const exampleModal = document.getElementById('exampleModal')
        exampleModal.addEventListener('show.bs.modal', event => {
        // Button that triggered the modal
        const button = event.relatedTarget
        // Extract info from data-bs-* attributes
        const title = button.getAttribute('data-bs-title')
        const description = button.getAttribute('data-bs-desc')

        // If necessary, you could initiate an AJAX request here
        // and then do the updating in a callback.

        // Update the modal's content.
        const modalTitle = exampleModal.querySelector('.modal-title')
        const modalBodyInput = exampleModal.querySelector('.modal-body input')

        // modalTitle.textContent = `New message to ${recipient}`
        // modalBodyInput.value = recipient
        })

        // // Mengambil data dengan AJAX dan menampilkannya di cards
        // var container = document.createElement('div');
        // container.classList.add("row", "row-cols-1", "row-cols-md-3", "g-4");

        // function getTasks() {
        //     container = innerHTML = "";
        //     $.get("{% url 'todolist:show_json' %}"), function(data){
        //         $.each(data, function(index, value){
        //             var card = document.createElement('div');
        //             card.classList.add("col-sm-4");
        //             card.innerHTML = `
        //             <div class="card">
        //                 <div class="card-header">
        //                     {% if value.is_finished %}
        //                         <h5>Done</h5>
        //                     {% else %}
        //                         <h5>In Progress</h5>
        //                     {% endif %}
        //                 </div>
        //                 <div class="card-body">
        //                     <h5 class="card-title">${value.title}</h5>
        //                     <p class="card-text">${value.description}</p>
        //                 </div>
                            
        //                 <div class="card-footer">
        //                     <p class="card-text"><small class="text-muted">Task created ${value.date}</small></p>
        //                     <div class = "btn-toolbar pull-right">
            
        //                         <form method="post" action="{% url 'todolist:delete-task' task.id %}" >
        //                             {% csrf_token %}
        //                             <button class="btn text-white me-1 btn-danger" type="submit" name="toggle_done">
        //                                 Delete
        //                             </button>
        //                         </form>

        //                         <form method="post" action="{% url 'todolist:toggle-task' task.id %}" >
        //                             {% csrf_token %}
        //                             <button class="btn text-white me-1" style="background-color: #446DCA;" type="submit" name="toggle_done">
        //                                 {% if task.is_finished %} Mark Not Done {% else %} Mark Done {% endif %}
        //                             </button>
        //                         </form>

        //                     </div>
        //                 </div>
        //             </div>
        //             `;
        //             container.appendChild(card);
        //         });
        //     }
        // }

        // $(document).ready(function(){
        //     getTasks();
        // });

        // async function refreshTodolist() {
        //     document.getElementById("div").innerHTML = ""
        //     const todolist = await getTasks()
        //     // $('#exampleModal').modal('toggle');
        //     let str = `<!-- Navigation Bar -->
        //     <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #446DCA;">
        //         <a class="navbar-brand" href="#">Welcome back, </a>
        //         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        //         <span class="navbar-toggler-icon"></span>
        //         </button>
        //         <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        //         <div class="navbar-nav">
        //             <a class="nav-item nav-link active" href="#">{{username}}</a>
        //             <a class="nav-item nav-link" href="{% url 'todolist:add_task' %} ">Add task</a>
        //             <a class="nav-item nav-link" href="{% url 'todolist:logout' %}">Log out</a>
        //             <!-- Button for Triggering Modal -->
        //             <a class="nav-item nav-link" data-bs-target="#exampleModal" data-bs-toggle="modal" href="#exampleModal">Add task with modal</a>
        //         </div>
        //         </div>

        //         <a class="nav-item nav-link active text-white" href="#">Sesi terakhir: {{ last_login }}</a>
        //     </nav>

        //     <!-- Modal -->
        //     <!-- Vertically centered scrollable modal -->
        //     <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        //         <div class="modal-dialog">
        //             <div class="modal-content">
        //             <div class="modal-header">
        //                 <h1 class="modal-title fs-5" id="exampleModalLabel">New task</h1>
        //                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        //             </div>
        //             <div class="modal-body">
        //                 <form>
        //                 <div class="mb-3">
        //                     <label for="recipient-name" class="col-form-label">Title:</label>
        //                     <input type="text" class="form-control" id="recipient-name">
        //                 </div>
        //                 <div class="mb-3">
        //                     <label for="message-text" class="col-form-label">Description:</label>
        //                     <textarea class="form-control" id="message-text"></textarea>
        //                 </div>
        //                 </form>
        //             </div>
        //             <div class="modal-footer">
        //                 <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
        //                 <button type="button" style="background-color: #446DCA;" class="btn btn-primary">Add task</button>
        //             </div>
        //             </div>
        //         </div>
        //     </div>
        //     `;
        //     todolist.forEach((item) => {
        //     htmlString += `<!-- Task Card -->
        //     <div class="row">
        //     {% for task in list_task %}
        //         <div class="col-sm-4">
        //             <div class="card">
        //                 <div class="card-header">
        //                     {% if task.is_finished %}
        //                         <h5>Done</h5>
        //                     {% else %}
        //                         <h5>In Progress</h5>
        //                     {% endif %}
        //                 </div>
        //                 <div class="card-body">
        //                     <h5 class="card-title">${item.task.title}</h5>
        //                     <p class="card-text">${item.task.description}</p>
        //                 </div>
                            
        //                 <div class="card-footer">
        //                     <p class="card-text"><small class="text-muted">Task created ${item.task.date}</small></p>
        //                     <div class = "btn-toolbar pull-right">
            
        //                         <form method="post" action="{% url 'todolist:delete-task' task.id %}" >
        //                             {% csrf_token %}
        //                             <button class="btn text-white me-1 btn-danger" type="submit" name="toggle_done">
        //                                 Delete
        //                             </button>
        //                         </form>

        //                         <form method="post" action="{% url 'todolist:toggle-task' task.id %}" >
        //                             {% csrf_token %}
        //                             <button class="btn text-white me-1" style="background-color: #446DCA;" type="submit" name="toggle_done">
        //                                 {% if task.is_finished %} Mark Not Done {% else %} Mark Done {% endif %}
        //                             </button>
        //                         </form>

        //                     </div>
        //                 </div>
        //             </div>
        //         </div>
        //     {% endfor %}
        //     </div>`;
        //     })
            
        //     document.getElementById("table").innerHTML = htmlString
        // }

        // function addTodolist() {
        //     fetch("{% url 'todolist:add_new_task' %}", {
        //         method: "POST",
        //         body: new FormData(document.querySelector('#form'))
        //     }).then(refreshTodolist)
        //     return false
        // }

        // function deleteTodolist(id) {
        //     fetch("{% url 'todolist:delete-task' id %}", {
        //         method: "POST",
        //         body: new FormData(document.querySelector('#form'))
        //     }).then(refreshTodolist)
        //     return false
        // }


    </script>

</body>
</html>